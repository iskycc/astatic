webpackJsonp([4],{Y2Ra:function(e,t){},f2My:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("Xxa5"),i=n.n(r),a=n("exGp"),o=n.n(a),s=n("o8EA"),l={filters:{parseTime:function(e){return Object(s.a)(new Date(e))},initSize:function(e){var t=e/1024;return(t=t.toFixed(2))>1024?(t=(t/=1024).toFixed(2))>1024?(t=(t/=1024).toFixed(2))>1024?(t=(t/=1024).toFixed(2),t+="TB"):t+="GB":t+="MB":t+="KB",t}},components:{vFile:n("xWEe").a},data:function(){return{tableData:[],centerDialogVisible:!1,now:{refresh_token:null,tip:null},fId:null,pageNum:1,showList:!1}},mounted:function(){this.init(),this.$store.commit("setMatched",[{path:"/home",title:"首页"},{path:"/list",title:"全部账号"}])},methods:{jsUrl:function(e,t){this.$router.push(e)},init:function(){var e=this;return o()(i.a.mark(function t(){var n;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$http.get("/account/list",{params:{t:(new Date).getTime()}});case 2:n=t.sent,e.tableData=n,console.log(n);case 5:case"end":return t.stop()}},t,e)}))()},addAccount:function(){this.now={refresh_token:null,tip:null},this.centerDialogVisible=!0},doChange:function(e){this.now=e,this.centerDialogVisible=!0},doAdd:function(){var e=this;return o()(i.a.mark(function t(){var n;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.now.refresh_token){t.next=2;break}return t.abrupt("return",e.$message({showClose:!0,message:"请输入refresh_token",type:"warning"}));case 2:if(t.prev=2,n=void 0,e.now.id){t.next=10;break}return t.next=7,e.$http.put("/account/list",e.now);case 7:n=t.sent,t.next=13;break;case 10:return t.next=12,e.$http.post("/account/list",e.now);case 12:n=t.sent;case 13:e.$message({showClose:!0,message:n,type:"success"}),t.next=18;break;case 16:t.prev=16,t.t0=t.catch(2);case 18:e.init(),e.centerDialogVisible=!1,e.now={refresh_token:null,tip:null};case 21:case"end":return t.stop()}},t,e,[[2,16]])}))()},doDel:function(e){var t=this;this.$confirm("此操作将永久删除该账号, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(o()(i.a.mark(function n(){var r;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.$http.delete("/account/list",{data:{id:e}});case 2:r=n.sent,t.$message({type:"success",message:r}),t.init();case 5:case"end":return n.stop()}},n,t)}))).catch(function(){})},showFile:function(e){var t=this;return o()(i.a.mark(function n(){return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(e&&void 0!=e){n.next=2;break}return n.abrupt("return",t.$message({message:"请选择账号",type:"warning"}));case 2:t.fId=e,t.pageNum=1,t.getFileMsg();case 5:case"end":return n.stop()}},n,t)}))()},getFileMsg:function(){var e=this;return o()(i.a.mark(function t(){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.showList=!0;case 1:case"end":return t.stop()}},t,e)}))()}}},c={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("el-button",{staticStyle:{"margin-bottom":"20px"},attrs:{type:"primary"},on:{click:function(t){return e.addAccount()}}},[e._v("新增账号")]),e._v(" "),n("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:""}},[n("el-table-column",{attrs:{prop:"date",label:"序号",width:"80",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.$index+1))]}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"user_name",label:"账号",width:"120",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("router-link",{attrs:{to:"/folder/"+t.row.user_id}},[n("el-link",{attrs:{underline:!1}},[e._v(e._s(t.row.user_name))])],1)]}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"userName",label:"容量",width:"200",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.type?[e._v("\n        "+e._s(e._f("initSize")(t.row.used_size))+"\n        /\n        "+e._s(e._f("initSize")(t.row.total_size))+"\n      ")]:void 0}}],null,!0)}),e._v(" "),n("el-table-column",{attrs:{prop:"tip",label:"备注",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.tip||"暂无备注"))]}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"address",label:"添加时间",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("parseTime")(t.row.createTime)))]}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"address",label:"操作",width:"250",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(n){return e.doDel(t.row.id)}}},[e._v("删除")]),e._v(" "),n("el-button",{attrs:{size:"mini",type:"warning"},on:{click:function(n){return e.doChange(t.row)}}},[e._v("修改")]),e._v(" "),n("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(n){return e.jsUrl("/folder/"+t.row.user_id,t.row.user_name)}}},[e._v("查看文件")])]}}])})],1),e._v(" "),n("el-dialog",{attrs:{title:e.now.id?"修改账号":"新增账号",visible:e.centerDialogVisible,width:"40%",center:""},on:{"update:visible":function(t){e.centerDialogVisible=t}}},[n("el-form",{attrs:{"label-position":"left",model:e.now,"label-width":"120px"}},[n("el-form-item",{attrs:{label:"refreshToken",required:""}},[n("el-input",{attrs:{placeholder:"请输入阿里云盘的refreshToken"},model:{value:e.now.refresh_token,callback:function(t){e.$set(e.now,"refresh_token",t)},expression:"now.refresh_token"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"备注信息"}},[n("el-input",{attrs:{placeholder:"账号备注"},model:{value:e.now.tip,callback:function(t){e.$set(e.now,"tip",t)},expression:"now.tip"}})],1)],1),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.centerDialogVisible=!1}}},[e._v("取 消")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.doAdd()}}},[e._v("确 定")])],1)],1),e._v(" "),n("el-drawer",{attrs:{size:"70%",title:"我的文件",visible:e.showList,direction:"rtl",wrapperClosable:!1},on:{"update:visible":function(t){e.showList=t}}},[n("v-file",{staticClass:"pk",attrs:{fId:e.fId}})],1)],1)},staticRenderFns:[]};var u=n("VU/8")(l,c,!1,function(e){n("y+yz")},"data-v-6da63746",null);t.default=u.exports},xWEe:function(e,t,n){"use strict";var r=n("Xxa5"),i=n.n(r),a=n("exGp"),o=n.n(a),s=n("o8EA"),l={data:function(){return{title:null,file_id:null,thumbnail:null,centerDialogVisible:!1,tableData:[],height:window.innerHeight-180}},components:{vPlay:n("kzMD").a},filters:{parseTime:function(e){return Object(s.a)(new Date(e))},initSize:function(e){var t=e/1024;return(t=t.toFixed(2))>1024?(t=(t/=1024).toFixed(2))>1024?(t=(t/=1024).toFixed(2))>1024?(t=(t/=1024).toFixed(2),t+="TB"):t+="GB":t+="MB":t+="KB",t}},computed:{user_id:function(){return this.$route.params.user_id},parent_file_id:function(){return this.$route.params.parent_file_id}},watch:{$route:function(e,t){this.init()}},mounted:function(){this.init()},methods:{init:function(){var e=this;return o()(i.a.mark(function t(){var n;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$http.get("/file/list",{params:{user_id:e.user_id,parent_file_id:e.parent_file_id}});case 2:n=t.sent,e.tableData=n,console.log(n);case 5:case"end":return t.stop()}},t,e)}))()},getAllLink:function(e){var t=this;return o()(i.a.mark(function n(){var r,a,o,s;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.$http.get("/file/list",{params:{user_id:t.user_id,parent_file_id:e}});case 2:for(o in r=n.sent,a="",r)"file"==(s=r[o]).type&&(a+=s.name,a+="$",a+=window.location.protocol+"//"+window.location.host+"/file/"+t.user_id+"/"+s.file_id+"/"+encodeURIComponent(s.name.replace("."+s.file_extension,""))+"."+s.file_extension,a+="\n");return n.prev=5,n.next=8,t.$copyText(a);case 8:t.$message({message:"链接已成功复制到剪贴板",type:"success"}),n.next=14;break;case 11:n.prev=11,n.t0=n.catch(5),t.$message.error("复制失败");case 14:case"end":return n.stop()}},n,t,[[5,11]])}))()},getOneLink:function(e,t,n){var r=this;return o()(i.a.mark(function a(){var o;return i.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return o=window.location.protocol+"//"+window.location.host+"/file/"+r.user_id+"/"+e+"/"+encodeURIComponent(t.replace("."+n,""))+"."+n,i.prev=1,i.next=4,r.$copyText(o);case 4:r.$message({message:"链接已成功复制到剪贴板",type:"success"}),i.next=10;break;case 7:i.prev=7,i.t0=i.catch(1),r.$message.error("复制失败");case 10:case"end":return i.stop()}},a,r,[[1,7]])}))()},doPriview:function(e){var t=this;return o()(i.a.mark(function n(){var r;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:"video"==e.category?(t.title=e.name,t.file_id=e.file_id,t.thumbnail=e.thumbnail,t.centerDialogVisible=!0):"image"==e.category?window.open(e.url):(r=window.location.protocol+"//"+window.location.host+"/file/"+t.user_id+"/"+e.file_id+"/"+encodeURIComponent(e.name.replace("."+e.file_extension,""))+"."+e.file_extension,window.open(r));case 1:case"end":return n.stop()}},n,t)}))()},doShare:function(e){var t=this;return o()(i.a.mark(function n(){var r;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return e.user_id=t.user_id,n.next=3,t.$http.put("/share/list",e);case 3:r=n.sent,t.$message({message:r,type:"success"});case 5:case"end":return n.stop()}},n,t)}))()}}},c={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"",stripe:""}},[n("el-table-column",{attrs:{prop:"name",label:"文件名"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("router-link",{attrs:{to:"/folder/"+e.user_id+"/"+t.row.file_id}},["folder"==t.row.type?n("el-link",{attrs:{type:"primary"}},[e._v(e._s(t.row.name))]):e._e()],1),e._v(" "),"file"==t.row.type?n("el-link",{attrs:{href:"/file/"+e.user_id+"/"+t.row.file_id+"/"+t.row.name,target:"_blank",type:"success"}},[e._v(e._s(t.row.name))]):e._e()]}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"size",label:"类型",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return["folder"==t.row.type?n("span",[e._v("文件夹")]):n("span",[e._v("文件")])]}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"size",label:"大小",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return["folder"==t.row.type?n("span",[e._v("————")]):n("span",[e._v(e._s(e._f("initSize")(t.row.size)))])]}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"updated_at",label:"更新时间",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(e._f("parseTime")(t.row.updated_at))+"\n      ")]}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"updated_at",label:"操作",width:"320"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("div",[n("div",{staticStyle:{"margin-bottom":"16px"}},["file"==t.row.type?n("el-button",{attrs:{size:"mini",round:"",type:"primary"},on:{click:function(n){return e.getOneLink(t.row.file_id,t.row.name,t.row.file_extension)}}},[e._v("获取文件直链")]):e._e(),e._v(" "),"file"!=t.row.type?n("el-button",{attrs:{size:"mini",round:"",type:"success"},on:{click:function(n){return e.doShare(t.row)}}},[e._v("分享文件夹")]):e._e(),e._v(" "),"file"==t.row.type?n("el-button",{attrs:{size:"mini",round:"",type:"danger"},on:{click:function(n){return e.doPriview(t.row)}}},[e._v("预览")]):e._e()],1),e._v(" "),"file"!=t.row.type?n("div",[n("el-button",{attrs:{size:"mini",round:"",type:"warning"},on:{click:function(n){return e.getAllLink(t.row.file_id)}}},[e._v("获取全部文件直链")])],1):e._e()])]}}])})],1),e._v(" "),n("el-dialog",{attrs:{title:e.title,"destroy-on-close":!0,visible:e.centerDialogVisible,width:"60%",center:""},on:{"update:visible":function(t){e.centerDialogVisible=t}}},[n("v-play",{key:e.file_id,attrs:{file_id:e.file_id,user_id:e.user_id,thumbnail:e.thumbnail}})],1)],1)},staticRenderFns:[]};var u=n("VU/8")(l,c,!1,function(e){n("Y2Ra")},null,null);t.a=u.exports},"y+yz":function(e,t){}});